<!DOCTYPE html>
<html lang="en">
<head>
    <title>AutoGrader CMPS2200</title>
    <!-- Recommended meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="https://tulane.edu/sites/default/files/favicon.ico" type="image/vnd.microsoft.icon">
    <!-- PyScript CSS -->
    <link rel="stylesheet" href="https://pyscript.net/releases/2025.7.3/core.css">
    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Grader Configuration -->
    <script>
        // The file for pytest
        const test_file = "test_main.py";
        // The files are imported by the test script
        const files = [
            "main.py"
        ];
        // The required packages. It can go with package version
        // The grader will auto fetch requirements.txt and merge
        // it with this package list
        const python_packages = [
            "pytest"
        ];
    </script>
</head>
<body>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="#">
                
                <svg xmlns="http://www.w3.org/2000/svg" height="83.623" width="247" viewBox="0 0 247 83.623">
                <g transform="matrix(1.3333 0 0 -1.3333 -611.9 596.16)">
                <path d="m460.14 445.58 5e-3 -12.736 7e-3 -20.296c0-7.2551 0.48131-9.4346 4.7684-14.443 4.2875-5.0066 15.26-9.0505 15.26-9.0505s10.962 4.0439 15.252 9.0505c4.2875 5.0079 4.7643 7.1875 4.7643 14.443l0.0112 20.296 2e-3 12.736s-4.9376-2.9215-9.963-2.5543c-5.6992 0.41639-10.066 2.6483-10.066 2.6483s-4.3779-2.232-10.074-2.6483c-5.0285-0.36714-9.9657 2.5543-9.9657 2.5543z" fill="#fff" stroke="#000" stroke-width=".48534"/>
                <path d="m543.73 446.15c-1.9521-0.62278-3.9038-1.132-5.855-1.6084v-0.58594c0.44281 0.0354 0.77439 0.07471 1.2539 0.07471 1.4341 0 1.6538-0.58656 1.6538-2.2324v-17.448c0-2.009-0.66195-2.4873-2.833-2.6323v-0.54932h8.6865v0.54932c-2.1352 0.11147-2.7612 0.40211-2.7612 2.5239v21.836l-0.14502 0.07177zm-37.904-0.76611-0.22119-6.2212h0.8833c0.81085 3.9889 1.8033 4.6831 5.8535 4.6831h1.9863v-18.286c0-2.7092-0.11048-3.5482-3.46-3.6973v-0.69287h10.748v0.69287c-3.0916 0.11193-3.5332 0.80772-3.5332 3.2944v18.688h1.9878c4.0484 0 5.0784-0.65664 5.852-4.6831h0.8833l-0.21973 6.2212h-20.76zm-25.651-1.415c9e-4 0-4.2247-2.107-9.4717-2.4902-4.7272-0.34655-9.2329 1.8105-9.2329 1.8105l0.0044-11.249 0.00586-19.08c0-6.8203 0.31762-9.004 4.3476-13.712 4.031-4.7075 14.347-8.5093 14.347-8.5093s10.304 3.8018 14.336 8.5093c4.0301 4.7084 4.2334 6.7573 4.2334 13.578l0.01172 19.08 0.00293 11.202s-4.3986-1.9754-9.123-1.6289c-5.3576 0.39132-9.4614 2.4902-9.4614 2.4902zm73.085-5.9736c-4.2687 0-6-2.5954-6-4.0591 0-0.5843 0.44368-1.6113 1.585-1.6113 0.95636 0 1.6553 0.80627 1.6553 1.5732 0 0.32684-0.18457 0.8775-0.18457 1.4282 0 1.1323 1.3995 1.79 2.6133 1.79 1.1037 0 2.833-0.40295 2.833-3.0352v-2.231c-5.9987-2.3416-9.2007-3.5857-9.2007-7.2436 0-2.4478 1.9153-3.8057 3.9023-3.8057 2.0246 0 3.9749 1.4662 5.3364 2.6733 0.18534-2.6335 1.7294-2.6733 2.3921-2.6733 0.58875 0 1.7308 0.03935 3.2768 1.8325v0.95069c-0.40565-0.32953-0.88261-0.6958-1.6567-0.6958-1.0661 0-1.0664 1.0591-1.0664 2.1211v7.1323c0 2.1944-2.3e-4 5.8535-5.4858 5.8535zm13.214 0c-1.6938-0.62235-3.423-1.172-5.0801-1.648v-0.62109c0.1473 0.07436 0.55121 0.14648 1.0679 0.14648 0.58922 0 1.2891-0.03633 1.2891-2.3408v-9.0703c0-2.1594-0.55367-2.6322-2.2837-2.7436v-0.54786h7.8032v0.54786c-1.9141 0.11146-2.4287 0.69529-2.4287 1.9028v10.277c1.3992 1.3522 2.5404 2.0845 3.6445 2.0845 2.1711 0 2.8345-1.3165 2.8345-3.5493v-7.6421c0-2.7786-0.95831-2.9618-2.3203-3.0732v-0.54932h7.6553v0.54932c-1.8021 0.14504-2.2441 0.69521-2.2441 2.4141v8.376c0 4.497-2.6133 5.4873-4.3066 5.4873-2.1711 0-3.57-1.2818-5.373-2.9648v2.8901l-0.25781 0.07471zm19.465 0c-2.9438 0-7.5088-2.2314-7.5088-8.9971 0-5.1924 2.7985-8.1973 6.8818-8.1973 5.3016 0 7.4368 4.9769 7.8062 6.1128l-0.59034 0.25341c-0.84712-1.3521-2.4298-3.8408-5.7041-3.8408-2.4298 0-5.4115 1.5012-5.852 7.9732h11.446c-0.40565 4.793-3.0194 6.6958-6.479 6.6958zm-64.626-0.36621v-0.51123c1.1037-0.07298 2.2822-0.1466 2.2822-2.3423v-9.2153c0-3.8792 2.8697-4.7593 4.3799-4.7593 0.66265 0 2.4306 0.15106 3.8643 1.5762l1.582 1.5703v-3.0352l0.0747-0.07178c1.7278 0.62101 3.1283 1.134 5.1167 1.6436v0.51562c-2.21-0.07432-2.2837 0.76802-2.2837 2.083v12.546h-5.814v-0.62256c2.5762-0.07253 2.7231-0.83922 2.7231-2.3042v-8.5942c0-1.2071-0.25665-1.5761-0.58887-1.8662-0.99397-0.80368-2.098-1.3169-3.2021-1.3169-2.4294 0-2.7598 2.2693-2.7598 2.7788v11.925h-5.3745zm-45.577-0.56397 0.44238-2.4434s-3.1406-0.22972-3.1406-3.9902c0.0228 0.0219 0.01171-10.891 0.01171-10.891s-0.03907-1.8363 0.41309-3.0044c0.63354-1.6316 1.6598-2.3555 6.665-2.3555l0.01904-4.5527 0.01905 4.5527c5.0043 0 6.0305 0.72393 6.6636 2.3555 0.4531 1.1681 0.41455 3.0044 0.41455 3.0044s-0.01084 10.913 0.01025 10.891c0 3.7605-3.1392 3.9902-3.1392 3.9902l0.44092 2.4434c1.5142-0.76786 7.9321-1.8076 7.9321-1.8076l0.16406-0.79395c-2.1124-0.96934-1.7637-6.7617-1.7637-6.7617v-9.4761c0-3.1498-0.9944-5.0164-1.8223-5.8931-3.1104-3.0939-7.5171-2.6809-8.918-2.6807l-0.00147 0.17578v-0.17578c-1.4009-2.3e-4 -5.8059-0.41321-8.9194 2.6807-0.82965 0.87666-1.8193 2.7433-1.8193 5.8931v9.4761s0.34548 5.7924-1.7651 6.7617l0.16259 0.79395s6.4182 1.0397 7.9307 1.8076zm109.39-0.38818c2.9062 0 3.2744-2.4518 3.5332-4.2056h-7.5806c0.58788 3.2192 2.0232 4.2056 4.0474 4.2056zm-29.369-5.707v-5.2998c0-1.0992-0.10868-1.5375-1.2495-2.0859-0.33222-0.18089-1.4736-0.65918-2.2822-0.65918-1.3625 0-2.4302 1.1351-2.4302 2.8535v0.07471c0 1.2407 0.40555 3.2868 5.9619 5.1167zm-0.32959-13.084c-1.2899 0-1.8384-1.1663-1.8384-1.8647 0-0.69443 0.51264-1.8662 1.8384-1.8662 1.1037 0 1.9131 0.80553 1.9131 1.8662 0 1.024-0.80943 1.8647-1.9131 1.8647zm58.931 0c-1.289 0-1.8428-1.1663-1.8428-1.8647 0-0.69443 0.51392-1.8662 1.8428-1.8662 1.1005 0 1.9116 0.80553 1.9116 1.8662 0 1.024-0.8111 1.8647-1.9116 1.8647zm-103.39-0.76611v-0.6958c2.7979-0.18223 3.3135-0.58676 3.3135-3.2915v-11.414c0-2.1925-9.3e-4 -9.3237 9.1274-9.3237 9.5327 0 9.5332 6.8761 9.5332 9.7998v9.5478c0 3.8398 0.6258 4.3875 3.46 4.6816v0.6958h-8.54v-0.6958c2.5772-0.1473 3.46-0.76712 3.46-4.6816v-9.873c0-2.9667-0.3685-4.1728-0.84668-4.9761-1.0678-1.7193-3.1658-2.8901-6.0366-2.8901-6.4035 0-6.4028 5.084-6.4028 7.4238v11.706c0 2.5946 0.44003 3.0699 3.3472 3.2915v0.6958h-10.415zm111.21-3.0366c-1.3616-1.936-1.9158-2.7429-3.315-4.169-0.80948-0.80547-1.6172-1.0261-1.6172-1.4648 0-0.10835 0.07382-0.21768 0.14502-0.25488h1.9541v-11.01c0-3.658 1.5079-4.648 3.3852-4.648 1.6933 0 3.424 1.2117 4.3052 2.7832l-0.47901 0.40283c-0.40251-0.47504-1.0667-1.2817-2.2456-1.2817-1.8769 0-1.8765 2.1595-1.8765 3.29v10.463h3.7207v1.1704h-3.7207v4.2422c0 0.29369 6.6e-4 0.47607-0.25634 0.47607zm-83.02-4.352c-1.6942-0.6228-3.4239-1.172-5.0801-1.648v-0.62109c0.14775 0.07436 0.5522 0.14648 1.0693 0.14648 0.58654 0 1.2876-0.03633 1.2876-2.3408v-9.0703c0-2.159-0.55353-2.6326-2.2822-2.7437v-0.54785h7.8018v0.54785c-1.9136 0.11104-2.4287 0.69575-2.4287 1.9028v10.277c1.3969 1.3522 2.5372 2.0845 3.6431 2.0845 2.1728 0 2.833-1.3165 2.833-3.5493v-7.6436c0-2.7782-0.95538-2.9607-2.3174-3.0718v-0.54785h7.6157 0.03956 8.688v0.54785c-2.5413 0.14507-2.7261 0.76568-2.7261 3.1816v12.986l-0.14648 0.10986c-1.9127-0.69712-3.791-1.3899-5.7041-2.0127v-0.54785c0.47639 0.07437 0.95682 0.14502 1.4722 0.14502 0.58921 0 1.2891-0.03703 1.2891-2.1929v-8.4873c0-2.8386-0.62474-3.0672-2.8872-3.1787-1.7894 0.14726-2.2295 0.69797-2.2295 2.4111v8.376c0 4.4975-2.6143 5.4873-4.3081 5.4873-2.1706 0-3.5686-1.2818-5.3716-2.9648v2.8901l-0.25782 0.07471zm41.688 0c-2.9461 0-7.5088-2.2314-7.5088-8.9971 0-5.1924 2.7977-8.1973 6.8833-8.1973 5.2998 0 7.4333 4.9769 7.8018 6.1128l-0.59033 0.25341c-0.84577-1.3522-2.4288-3.8394-5.7026-3.8394-2.4316 0-5.4129 1.4997-5.8535 7.9717h11.448c-0.40834 4.793-3.0175 6.6958-6.4775 6.6958zm11.629 0c-1.8039-0.73295-3.6465-1.3904-5.4478-1.9761v-0.58593c0.33043 0.07481 0.7325 0.14648 1.251 0.14648 0.58742 0 1.2876-0.03703 1.2876-2.1929v-9.145c0-2.0479-0.58741-2.1577-2.6148-2.5239v-0.54785h8.8345v0.54785c-1.8774 0.07254-3.1274 0.22158-3.1274 2.7437v8.2295c0 1.1699 1.6196 3 2.5034 3 0.88248 0 1.2509-1.2817 2.5386-1.2817 0.88517 0 1.4018 0.69471 1.4018 1.6099 0 1.2071-0.73695 1.9761-1.9893 1.9761-1.4014 0-2.6503-0.73363-4.3799-3.3296h-0.07471v3.2549l-0.1831 0.07471zm12.089 0c-3.5675 0-5.1518-2.4154-5.1518-4.4634 0-2.7043 2.0231-4.0581 4.3052-5.3408l2.1343-1.2041c1.1798-0.66175 1.916-1.5378 1.916-2.71 0-2.0829-1.7291-2.669-2.981-2.669-3.6083 0-4.3092 3.1829-4.7476 5.1211h-0.5918v-5.707h0.48047c0.22073 0.32863 0.36636 0.43946 0.81006 0.43946 1.0307 0.03761 2.6133-0.66065 4.2686-0.66065 2.3564 0 5.3379 1.541 5.3379 4.7212 0 2.1966-1.2902 3.2189-3.0923 4.3154l-3.9741 2.3423c-1.3629 0.80368-1.5835 1.8632-1.5835 2.5957 0 0.95054 0.77307 2.3774 2.7964 2.3774 1.6204 0 3.2768-0.76903 4.0854-4.5h0.55078l-0.14502 5.0127h-0.40576c-0.10835-0.14775-0.29327-0.4043-0.62549-0.4043-0.62727 0-1.7659 0.73389-3.3867 0.73389zm11.521 0c-1.9136-0.69712-3.7914-1.3899-5.7041-2.0127v-0.54785c0.47684 0.07437 0.953 0.14502 1.4692 0.14502 0.59011 0 1.2905-0.03703 1.2905-2.1929v-8.4873c0-2.8512-0.62639-3.0706-2.9062-3.1816v-0.54785h8.7188v0.54785c-2.536 0.14507-2.7188 0.76568-2.7188 3.1816v12.986l-0.14941 0.10986zm-57.844-0.36621v-0.54932c0.73517-0.03537 1.4731-0.25613 2.023-1.3535 1.3275-2.5946 4.8588-11.08 5.7422-13.349 0.58877-1.5751 0.66139-1.7183 0.99316-1.7183 0.25789 0 0.58999 0.83974 0.99609 1.8252l4.708 11.741c0.88561 2.159 1.1421 2.7471 2.3936 2.855v0.54932h-5.1167v-0.54932c0.92278-0.03537 1.73-0.36619 1.73-1.207 0-1.3168-2.6128-7.0221-3.8643-10.534l-3.7529 9.3618c-0.11104 0.2955-0.33398 0.84117-0.33398 1.2817 0 0.91338 0.80864 1.0229 1.6934 1.0972v0.54932h-7.2114zm68.427 0v-0.51123c0.47549-0.07253 1.4356-0.25504 1.8779-1.1733l4.1924-8.9971c0.51579-1.1328 2.2837-4.4965 2.2837-5.0449 0-0.58383-1.4727-5.6352-3.3867-5.6352-0.4755 0-1.6198 0.66065-2.6133 0.66065-1.6938 0-1.7666-1.3897-1.7666-1.6113 0-0.94785 0.84812-2.1196 2.6865-2.1196 2.7598 0 4.3797 2.4153 6.2593 7.314l5.6675 14.924c0.55295 1.4986 1.2856 1.5707 1.7651 1.645v0.54932h-4.9673v-0.54932c1.1762 0.03716 1.7666-0.32816 1.7666-1.0239 0-0.32909-0.48145-1.5001-0.84814-2.4873l-2.8726-8.1196-4.229 9.252c-0.11103 0.25655-0.37061 0.84062-0.37061 1.3184 0 0.98593 1.2877 1.0252 2.1357 1.0606v0.54932h-7.5806zm-46.635-0.95215c2.9071 0 3.2748-2.4518 3.5332-4.2056h-7.582c0.5919 3.2192 2.026 4.2056 4.0488 4.2056z" fill="#21543f"/>
                <path d="m475.74 437.07c-1.5124-0.76787-7.9307-1.8076-7.9307-1.8076l-0.16259-0.79395c2.1106-0.96935 1.7651-6.7617 1.7651-6.7617v-9.4761c0-3.1498 0.98969-5.0164 1.8193-5.8931 3.1136-3.0939 7.5185-2.6809 8.9194-2.6807v0.17578l-0.01904 4.5527c-5.0052 0-6.0315 0.72392-6.665 2.3555-0.45216 1.1681-0.41309 3.0044-0.41309 3.0044s0.01109 10.913-0.01171 10.891c0 3.7605 3.1406 3.9902 3.1406 3.9902l-0.44238 2.4434zm4.4106-27.237 0.00147-0.17578c1.4009-2.3e-4 5.8075-0.41321 8.918 2.6807 0.82786 0.87666 1.8223 2.7433 1.8223 5.8931v9.4761s-0.34873 5.7924 1.7637 6.7617l-0.16406 0.79395s-6.4179 1.0398-7.9321 1.8076l-0.44092-2.4434s3.1392-0.22971 3.1392-3.9902c-0.02109 0.0219-0.01025-10.891-0.01025-10.891s0.03855-1.8363-0.41455-3.0044c-0.6331-1.6315-1.6592-2.3555-6.6636-2.3555l-0.01905-4.5527z" fill="none" stroke="#000" stroke-width=".37341"/>
                <path d="m480.15 430.99c9.3366 0 13.869-1.1905 13.869-1.1905l1.9566-6.9775-2.1514-1.2326-3.247 4.6793c-3.9651 0.56727-8.0435 0.5328-8.0435 0.5328l-0.0296-18.494c0-1.5406 0.2955-2.5897 1.7703-2.5897h2.7415v-4.5324h-6.8946 0.0591-6.8987v4.5324h2.7451c1.4748 0 1.769 1.049 1.769 2.5897l-0.0287 18.494s-4.0793 0.0345-8.0413-0.5328l-3.251-4.6793-2.1487 1.2326 1.9575 6.9775s4.5275 1.1905 13.868 1.1905z" fill="#fff" stroke="#000" stroke-width=".37341"/>
                </g>
                </svg>
                
            </a>
        </div>
        <div class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item">
                    <b><i class="fa-solid fa-microscope"></i> Auto Grader</b>
                </a>
            </div>
            <div class="navbar-end">
                <a class="navbar-item">
                    Introduction to Algorithm <b>CMPS 2200</b>
                </a>
            </div>
        </div>
    </nav>
    <div class="section is-fullheight">
        <!-- <section class="hero">
            <div class="hero-body">
                <div class="content">
                    <p class="title"><i class="fa-solid fa-microscope"></i> Auto Grader</p>
                    <p class="subtitle">CMPS 2200 - Introduction to Algorithm</p>
                </div>
            </div>
        </section> -->
        <section class="hero">
            <div class="hero-body">
                <div class="container">
                    <div class="content">
                        <p class="title">Auto Grader</p>
                        <p class="subtitle">CMPS 2200 Introduction to Algorithm</p>
                    </div>
                </div>
                <div class="container mt-6">
                    <div class="card">
                        <div class="card-content">
                            <div class="content">
                                <p class="title is-5"><i class="fa-solid fa-rocket"></i> Start Evaluating</p>
                                <p class="subtitle is-6">Start with Your Repository Link</p>
                            </div>
                            <div class="field has-addons has-addons-centered ml-2 mr-2">
                                <p class="control is-expanded">
                                    <input class="input is-fullwidth" type="text" placeholder="Repository Link" id="github-url-input">
                                </p>
                                <p class="control">
                                    <button class="button" id="evaluate-button">
                                        <span class="icon is-small">
                                        <i class="fa-solid fa-play"></i>
                                        </span>
                                        <span>Submit</span>
                                    </button>
                                </p>
                            </div>
                            <article class="message is-danger" style="display: none;" id="error-link">
                                <div class="message-header">
                                    <p>Invalid Link</p>
                                </div>
                                <div class="message-body">
                                    The link should be like: <li>https://github.com/{user_name}/{repository_name}(/tree/main)</li>
                                </div>
                            </article>
                            <article class="message" style="display: none;" id="info-link">
                                <div class="message-header">
                                    <p>Project Information</p>
                                </div>
                                <div class="message-body">
                                    <li>Owner: <span id="repo-info-owner"></span></li>
                                    <li>Project: <span id="repo-info-project"></span></li>
                                    <li>Visit the repository: <a id="repo-info-link"></a></li>
                                </div>
                            </article>
                        </div>
                    </div>
                </div>
                <div class="container mt-4" id="grader-panel" style="display:none;">
                    <div class="container">
                        <div class="tabs is-centered is-boxed">
                            <ul>
                                <li class="is-active">
                                <a>
                                    <span class="icon is-small"
                                    ><i class="fa-solid fa-list-check"></i></i
                                    ></span>
                                    <span>Tests</span>
                                </a>
                                </li>
                                <li>
                                <a>
                                    <span class="icon is-small"
                                    ><i class="fa-solid fa-terminal"></i></i
                                    ></span>
                                    <span>Terminal</span>
                                </a>
                                </li>
                                <li>
                                <a>
                                    <span class="icon is-small"
                                    ><i class="fa-solid fa-screwdriver-wrench"></i></i
                                    ></span>
                                    <span>Config</span>
                                </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    

                    <div class="container" id="tab-tests">
                        <div class="card">
                            <div class="card-content">
                                <div class="content">
                                    <p class="title is-6">Test Points</p>
                                    <div id="test-lists">
                                        <span id="test-lists-loading"><i class="fa-solid fa-spinner fa-spin"></i>Tests Loading</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container" id="tab-terminal">
                        <div class="card">
                            <div class="card-content">
                                <p class="title is-6">Terminal</p>
                                <div style="max-width: 100%;">
                                    <script type="py" terminal id="terminal-io" style="max-width: 100%; overflow-y: auto;"></script>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    <div class="container" id="tab-config">
                        <div class="card">
                            <div class="card-content">
                                <p class="title is-6">Config</p>
                                <div class="content" id="config-panel">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container mt-4">
                    <div class="card">
                        <div class="card-content">
                            <div class="content">
                                <p class="title is-5"><i class="fa-solid fa-clock-rotate-left"></i> History</p>
                                <p class="subtitle is-6">Your Grading History</p>
                                <button onclick="clearRecords(); renderHistory();" class="button is-outlined is-danger is-small">
                                    <i class="fa-solid fa-trash"></i> Clear
                                </button>
                                <div class="table-container">
                                    <table class="table is-fullwidth">
                                        <thead>
                                            <tr><th>#</th><th>Datetime</th><th>Passed/Total</th><th>Owner</th><th>Project</th><th>URL</th></tr>
                                        </thead>
                                        <tbody  id="history-list">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> 
        </section>
    </div>
    
    
    <footer class="footer">
        <div class="content has-text-centered">
            Grader for <strong>CMPS2200</strong> Introduction to algorithms. <br>
            Copyright &copy; 2025 Tulane University Department of Computer Science. All rights reserved. <br>
        </div>
    </footer>

    <script>
        
        const pyscript_config = {
            packages: python_packages,
        };
        var repository_url = "";
        var repository_raw_url = "";
        const pyscript_code = `
        import pytest
        import pyscript
        import json
        import ast
        import time
        from js import document, window, saveRecord, renderHistory

        def get_root_functions(filepath):
            """
            Parse a Python file and return a list of root-level function names.
            """
            with open(filepath, "r", encoding="utf-8") as f:
                node = ast.parse(f.read(), filename=str(filepath))

            # Only pick FunctionDef nodes at the module's top-level body
            functions = [n.name for n in node.body if isinstance(n, ast.FunctionDef)]
            return functions
        
        try:
            print(f"Auto Grader for CMPS2200 Introduction to Algorithm")
            print(f"Version 0.0.1")
            print(f"Driven by PyScript")
            print(f"--------------------------------------------------")
            functions = get_root_functions('${test_file}')
            print(f"{len(functions)} tests point found.")
            container = document.getElementById("test-lists")
            container.innerHTML = ""  # Clear previous content

            # Create table
            table = document.createElement("table")
            table.className = "table is-striped is-fullwidth"

            # Table header
            thead = document.createElement("thead")
            thead.innerHTML = "<tr><th>#</th><th>Function Name</th><th>Time</th><th>Status</th></tr>"
            table.appendChild(thead)

            # Table body
            tbody = document.createElement("tbody")
            for i, fn in enumerate(functions, 1):
                row = document.createElement("tr")
                row.innerHTML = f"<td>{i}</td><td><i class='fa-solid fa-rocket'></i>{fn}</td><td><span id='{i}-time'><i class='fa-solid fa-spinner fa-spin'></i></span></td><td><span id='{i}-status'><i class='fa-solid fa-spinner fa-spin'></i></span></td>"
                tbody.appendChild(row)

            table.appendChild(tbody)

            counter = document.createElement("p")
            counter.innerHTML = f'<span id="total-passed-counter">0</span>/{len(functions)} Tests Passed'
            container.appendChild(counter)
            container.appendChild(table)

            pytest_exit_code_map = {
                0: 'tests passed',
                1: 'tests failed',
                2: 'pytest was interrupted',
                3: 'an internal error got in the way',
                4: 'pytest was misused',
                5: "pytest couldn't find tests",
            }

            passed_nums = 0
            counter = document.getElementById("total-passed-counter")
            for i,test_name in enumerate(functions):
                t_start = time.perf_counter()
                retcode = pytest.main([f'test_main.py::{test_name}'])
                t_cost = (time.perf_counter() - t_start) * 1000
                status = document.getElementById(f"{i+1}-status")
                tims_status = document.getElementById(f"{i+1}-time")
                tims_status.innerHTML = f'<i class="fa-regular fa-clock"></i>{t_cost:.2f} ms'
                if retcode == 0:
                    status.innerHTML = f'<i class="fa-solid fa-check has-text-success"></i>{pytest_exit_code_map[retcode]}'
                    passed_nums += 1
                    counter.innerHTML = passed_nums
                else:
                    status.innerHTML = f'<i class="fa-solid fa-xmark has-text-danger"></i>{pytest_exit_code_map[retcode]}'
            saveRecord(window.repository_url, len(functions), passed_nums, window.info_owner, window.info_repo)
            renderHistory()
        except Exception as e:
            container = document.getElementById("test-lists")
            container.innerHTML = '''
            <article class="message is-danger">
                <div class="message-header">
                    <p>Test Failed</p>
                </div>
                <div class="message-body">
                    Please check the terminal for detailed error messages.
                </div>
            </article>
            '''
            raise e
        `;

        // Helper: get current datetime string
        function getFormattedDatetime() {
            const now = new Date();
            const pad = n => n.toString().padStart(2, '0');
            return `${now.getFullYear()}/${pad(now.getMonth() + 1)}/${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
        }

        // Save record into localStorage
        function saveRecord(url, total, passed, owner, project) {
            const datetime = getFormattedDatetime();
            const record = { datetime, url, total, passed, owner, project };

            const key = `record_${Date.now()}`;
            localStorage.setItem(key, JSON.stringify(record));
        }

        // Clear all record entries from localStorage
        function clearRecords() {
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith("record_")) {
                    localStorage.removeItem(key);
                }
            });
        }

        // Render history table
        function renderHistory() {
            const container = document.getElementById("history-list");
            container.innerHTML = ""; // Clear existing

            // Collect all stored records
            const keys = Object.keys(localStorage).filter(k => k.startsWith("record_")).sort((a, b) => Number(b.split("_")[1]) - Number(a.split("_")[1]));
            keys.forEach((key, i) => {
                try {
                    const record = JSON.parse(localStorage.getItem(key));
                    const tr = document.createElement("tr");

                    const cells = [
                        i + 1,
                        record.datetime,
                        `${record.passed}/${record.total}`,
                        record.owner,
                        record.project,
                        record.url
                    ];

                    cells.forEach(cell => {
                        const td = document.createElement("td");
                        td.textContent = cell;
                        tr.appendChild(td);
                    });

                    container.appendChild(tr);
                } catch (e) {
                    console.warn("Invalid record:", key);
                }
            });
        }

        /**
        * Fetch a requirements file from a URL, merge with a given list, and remove duplicates.
        * @param {string} url - URL of the txt file
        * @param {string[]} existingList - an array of strings to merge with
        * @returns {Promise<string[]>} - a Promise that resolves to the merged list
        */
        async function fetchRequirements(url, existingList) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Failed to fetch: ${response.status} ${response.statusText}`);
                }

                const text = await response.text();

                // Split by newline and remove empty items
                const fetchedList = text
                    .split("\n")
                    .map(item => item.trim())
                    .filter(item => item.length > 0);

                // Merge with existing list and remove duplicates
                const mergedSet = new Set([...existingList, ...fetchedList]);

                // Convert Set back to array
                return Array.from(mergedSet);
            } catch (err) {
                console.error("Error fetching requirements:", err);
                return existingList; // fallback to original list
            }
        }

        /**
        * Build a file config dictionary
        * @param {string} url - base URL
        * @returns {Object} - dictionary in format { url+filename: filename }
        */
        function buildFileConfig(url) {
            const config = {};
            for (const filename of files) {
                config[url + filename] = filename;
            }
            config[url + test_file] = test_file;
            return config;
        }

        /**
        * Reload the current page with a `repo` parameter
        * @param {string} repo - the repo string to set
        */
        function reloadWithRepo(repo) {
            const url = new URL(window.location.href);
            url.searchParams.set("repo", repo); // set or replace the 'repo' parameter
            window.location.href = url.toString(); // reload page with new URL
        }
        /**
        * Convert a GitHub repo URL to its raw content base URL.
        *
        * @param {string} repoUrl - GitHub repo URL (e.g. "https://github.com/org/repo/").
        * @param {string} [branch="main"] - Branch name to use.
        * @returns {string} Raw content base URL.
        * @throws {Error} If the URL is not a valid GitHub repository URL.
        */
        function githubToRaw(repoUrl, branch = "main") {
            try {
                const url = new URL(repoUrl);

                // Check domain
                if (url.hostname !== "github.com") {
                throw new Error("Not a valid github.com URL");
                }

                // Split pathname into parts: ["", "org", "repo", ...]
                const parts = url.pathname.split("/").filter(Boolean);

                if (parts.length < 2) {
                throw new Error("Invalid GitHub repository URL format. Expected https://github.com/{owner}/{repo}/");
                }

                const owner = parts[0];
                const repo = parts[1];

                return `https://raw.githubusercontent.com/${owner}/${repo}/refs/heads/${branch}/`;
            } catch (err) {
                throw new Error(`Failed to transform URL: ${err.message}`);
            }
        };

        function githubToComponent(repoUrl, branch = "main") {
            try {
                const url = new URL(repoUrl);

                // Check domain
                if (url.hostname !== "github.com") {
                throw new Error("Not a valid github.com URL");
                }

                // Split pathname into parts: ["", "org", "repo", ...]
                const parts = url.pathname.split("/").filter(Boolean);

                if (parts.length < 2) {
                throw new Error("Invalid GitHub repository URL format. Expected https://github.com/{owner}/{repo}/");
                }

                const owner = parts[0];
                const repo = parts[1];

                return {"owner":owner, "repo":repo};
            } catch (err) {
                throw new Error(`Failed to transform URL: ${err.message}`);
            }
        };

        function prompt_invalid_link(show = false) {
            const el = document.getElementById("error-link");
            if (show) {
                el.style.display = "block";  // show the block
            } else {
                el.style.display = "none";   // hide the block
            }
        };

        function prompt_info_link(show = false) {
            const el = document.getElementById("info-link");
            if (show) {
                el.style.display = "block";  // show the block
            } else {
                el.style.display = "none";   // hide the block
            }
        };

        function evaluate(github_url) {
            try {
                prompt_invalid_link(false);
                reloadWithRepo(github_url);
            } catch (err) {
                prompt_invalid_link(true);
            }
        };

        const github_url_input = document.getElementById("github-url-input");
        const evaluate_button = document.getElementById("evaluate-button");
        evaluate_button.addEventListener("click", () => {
            evaluate(github_url_input.value.trim());
        });

        github_url_input.addEventListener("keypress", (event) => {
            if (event.key === "Enter") {
                event.preventDefault(); // prevent form submission if inside a form
                evaluate(github_url_input.value.trim());
            }
        });

        /**
        * Run a Python script using PyScript with custom config.
        * @param {Object} config - PyScript config JSON object
        * @param {string} pyCode - Python script code
        */
        function runPyScript(config, pyCode) {

            // Inject config
            const configTag = document.createElement("py-config");
            configTag.textContent = JSON.stringify(config, null, 2);
            document.body.appendChild(configTag);

            // Inject python script
            const scriptTag = document.getElementById("terminal-io");
            scriptTag.textContent = pyCode;
        };

        function toggleGraderPanel(show) {
            const panel = document.getElementById("grader-panel");
            if (!panel) return;

            panel.style.display = show ? "block" : "none";
        };


        /**
        * Check if the current page URL has a `repo` parameter.
        * If yes, call `autograde(repoValue)`.
        */
        async function checkRepoParam() {
            const url = new URL(window.location.href);
            const repo = url.searchParams.get("repo");
            if (repo) {
                await autograde(repo);
            }
        };
        var info_owner = "";
        var info_repo = "";
        function loadRepoInfo(github_url) {
            document.getElementById("github-url-input").value = github_url;
            let info = githubToComponent(github_url);
            document.getElementById("repo-info-link").innerHTML = github_url;
            document.getElementById("repo-info-link").target = '_blank';
            document.getElementById("repo-info-link").href = github_url;
            document.getElementById("repo-info-project").innerHTML = info["repo"];
            document.getElementById("repo-info-owner").innerHTML = info["owner"];
            info_owner = info["owner"];
            info_repo = info["repo"];
        };

        function loadConfigInfo() {
            const configPanel = document.getElementById("config-panel");
            configPanel.innerHTML = `
            <li>Packages: ${pyscript_config["packages"]}</li>
            <li>Test File: ${test_file}</li>
            <li>Repository Raw: ${repository_raw_url}</li>
            <li>Repository: ${repository_url}</li>
            <li>Files:</li>
            ${JSON.stringify(pyscript_config["files"], null, 2)}
            `
        };
        // Example autograde function for testing
        async function autograde(github_url) {
            try {
                github_raw_url = githubToRaw(github_url);
                prompt_invalid_link(false);
                
            } catch (err) {
                prompt_invalid_link(true);
                prompt_info_link(false);
                toggleGraderPanel(false);
                return;
            }
            loadRepoInfo(github_url);
            prompt_info_link(true);
            toggleGraderPanel(true);
            repository_url = github_url;
            repository_raw_url = github_raw_url;
            pyscript_config['files'] = buildFileConfig(github_raw_url);
            pyscript_config['packages'] = await fetchRequirements(github_raw_url+'requirements.txt', pyscript_config['packages']);
            loadConfigInfo();
            runPyScript(pyscript_config, pyscript_code);
            
        };

        document.addEventListener("DOMContentLoaded", () => {
            const tabs = document.querySelectorAll(".tabs ul li");
            const containers = {
                0: document.getElementById("tab-tests"),
                1: document.getElementById("tab-terminal"),
                2: document.getElementById("tab-config"),
            };

            function showTab(index) {
                // Set active class on tabs
                tabs.forEach((tab, i) => {
                    if (i === index) tab.classList.add("is-active");
                    else tab.classList.remove("is-active");
                });

                // Show/hide containers
                Object.keys(containers).forEach(key => {
                    if (parseInt(key) === index) {
                        containers[key].style.display = "block";
                    } else {
                        containers[key].style.display = "none";
                    }
                });
            }

            // Initialize: show first tab
            showTab(0);

            // Add click listeners
            tabs.forEach((tab, i) => {
                tab.addEventListener("click", () => showTab(i));
            });
        });

        /**
        * Dynamically load a JS module script
        * @param {string} src - URL of the script
        * @returns {Promise} - resolves when the script is loaded
        */
        function loadModuleScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "module";
                script.src = src;
                script.onload = () => resolve();
                script.onerror = () => reject(new Error(`Failed to load script: ${src}`));
                document.head.appendChild(script);
            });
        }

        // Call the checker on page load
        (async () => {
            await checkRepoParam();
            renderHistory();
            loadModuleScript("https://pyscript.net/releases/2025.7.3/core.js")
            .then(() => {
                console.log("PyScript core loaded successfully!");
                // You can initialize PyScript-dependent code here
            })
            .catch(err => console.error(err));
        })();
        
    </script>
    <!-- This script tag bootstraps PyScript -->
    <!-- <script type="module" src="https://pyscript.net/releases/2025.7.3/core.js"></script> -->
    
</body>
</html>